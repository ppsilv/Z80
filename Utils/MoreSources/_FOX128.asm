	ORG	#8000

	DI
	CALL	#52
KNOW_A	DEC	SP
	DEC	SP
	LD	HL,#4000
	LD	DE,#4001
	LD	BC,6911
	LDIR
	POP	HL
	PUSH	HL
	LD	DE,PROG-KNOW_A+LEN_PROG-1
	ADD	HL,DE
	LD	DE,#4800+LEN_PROG-1
	LD	BC,LEN_PROG
	LDDR
	POP	HL
	LD	(L4B89),SP
	LD	SP,L4DFF
	PUSH	HL
	LD	A,69
	CALL	L4883
	POP	HL
	LD	DE,TEXT1-KNOW_A
	ADD	HL,DE
	CALL	L4AA3
	LD	DE,#0100
	LD	(L48D2),DE
	CALL	L4AA3
	LD	DE,#0303
	LD	(L48D2),DE
	CALL	L4AA3
	LD	DE,#0408
	LD	(L48D2),DE
	CALL	L4AA3
	LD	DE,#0604
	LD	(L48D2),DE
	CALL	L4AA3
	XOR	A
SOUND	LD	BC,#FFFD
	OUT	(C),A
	PUSH	AF
	LD	A,(HL)
	LD	B,#BF
	OUT	(C),A
	POP	AF
	INC	HL
	INC	A
	CP	#E
	JR	NZ,SOUND
	CALL	L4F89
	JP	L489D

TEXT1	DEFB	"FOXMON	128K (C)1993 by	(R)sof",#80+"t"
	DEFB	"Thanks	to SABSOFT & James Adven",#80+"t"
	DEFB	"Special thanks	to Rst7	fo",#80+"r"
	DEFB	"disks procedure",#80+"s"
	DEFB	"Interface: ZX-LPRINT II",#80+"I"
	DEFB	0,6,3,2,6,2,#10,#DC,#10,#10,#10,#11,#11,1

PROG	DISP	#4800

L4860	LD	HL,#4000
	LD	DE,#4001
	LD	BC,2047
	LD	(HL),L
	LDIR
	LD	A,7
L4883	LD	HL,#5800
	LD	DE,#5801
	LD	BC,#00FF
	LD	(HL),A
	LDIR
	INC	HL
	INC	DE
	LD	BC,#01FF
	LD	(HL),L
	LDIR
	XOR	A
	OUT	(254),A
	RET

L489D	CALL	L4860
L48A0	LD	B,#08
	CALL	L4A8E
	XOR	A
	LD	(L4FC4),A
	CALL	L4F8C
	CP	#51
	JP	Z,L4B83
	CP	#52
	JP	Z,L52CD
	LD	HL,L4960
	LD	C,A
L48BA	LD	A,(HL)
	AND	A
	JR	Z,L48A0
	CP	C
	JR	Z,L48C6
	INC	HL
	INC	HL
	INC	HL
	JR	L48BA
L48C6	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
	LD	DE,L48A0
	PUSH	DE
	JP	(HL)

L48D0	DEFB	0
L48D1	DEFB	4
L48D2	DEFB	1,0
L48D4	DEFB	7
L48D5	DEFB	#15,0

L48D7	CALL	L4A7C
	LD	HL,L4BC3
	CALL	L4AA3
	LD	A,#03
	CALL	L4D69
	JR	C,L48FB
	LD	A,#3D
	CALL	L4FC7
	LD	B,#08
L48EE	XOR	A
	RL	L
	ADC	A,#30
	CALL	L4FC7
	DJNZ	L48EE
	CALL	L4F89
L48FB	JP	L4A7C

L4960	DEFB	"M"
	DEFW	L499D
	DEFB	"H"
	DEFW	L4A6D
	DEFB	"A"
	DEFW	L4A60
	DEFB	"6"
	DEFW	L49B1
	DEFB	"7"
	DEFW	L49CE
	DEFB	"5"
	DEFW	L49D6
	DEFB	"8"
	DEFW	L5000
	DEFB	"O"
	DEFW	L500D
	DEFB	"P"
	DEFW	L4D60
	DEFB	"<"
	DEFW	LEFTAB
	DEFB	">"
	DEFW	RIGTAB
	DEFB	#22
	DEFW	LPLINE
	DEFB	"-"
	DEFW	L504C
	DEFB	"I"
	DEFW	L50F5
	DEFB	"L"
	DEFW	L5174
	DEFB	"D"
	DEFW	L51B8
	DEFB	"F"
	DEFW	L5228
	DEFB	"T"
	DEFW	L5208
	DEFB	"G"
	DEFW	L5245
	DEFB	"B"
	DEFW	L48D7
	DEFB	"N"
	DEFW	L52A1
	DEFB	"W"
	DEFW	L52EA
	DEFB	"_"
	DEFW	STR0
	DEFB	"!"
	DEFW	STR1
	DEFB	"#"
	DEFW	STR3
	DEFB	"$"
	DEFW	STR4
	DEFB	"&"
	DEFW	STR6
	DEFB	"'"
	DEFW	STR7
	DEFB	")"
	DEFW	REM_S
	DEFB	"J"
	DEFW	LOAD_F
	DEFB	"S"
	DEFW	SAVE_F
	DEFB	"Z"
	DEFW	SAVE_C
	DEFB	"X"
	DEFW	LOAD_C
	DEFB	#00

	*$DISK

STR0	LD	A,#10
	JR	S_C
STR1	LD	A,#11
	JR	S_C
STR3	LD	A,#13
	JR	S_C
STR4	LD	A,#14
	JR	S_C
STR6	LD	A,#16
	JR	S_C
STR7	LD	A,#17
S_C	LD	(BOX_S),A
	LD	BC,#7FFD
	OUT	(C),A
REM_S	CALL	L4A7C
	LD	A,(BOX_S)
	ADD	A,#20
	CALL	L4FC7
	CALL	L4F89
STIR_1	JP	L4A7C

BOX_S	DEFB	#10

LEFTAB	LD	A,8
	JR	RIGT_A

RIGTAB	LD	A,42
RIGT_A	LD	(COPY_1+1),A
	RET

LPLINE	CALL	COPY_1
	RET

L499D	CALL	L4A7C
	LD	HL,L4B90
	CALL	L4AA3
	CALL	L4D67
	JR	C,L49AE
	LD	(L4B8B),HL
L49AE	JR	STIR_1

L49B1	LD	A,(L4B8D)
	BIT	1,A
	JR	NZ,L49C6
	LD	A,#C9
	LD	(L4FC7),A
	CALL	L556C
	LD	A,#E5
	LD	(L4FC7),A
	RET

L49C6	LD	HL,(L4B8B)
	INC	HL
	LD	(L4B8B),HL
	RET

L49CE	LD	HL,(L4B8B)
	DEC	HL
	LD	(L4B8B),HL
	RET

L49D6	LD	A,(L4B8D)
	BIT	1,A
	JR	NZ,L49F1
	LD	A,#C9
	LD	(L4FC7),A
	LD	B,8
L49E4	PUSH	BC
	CALL	L556C
	POP	BC
	DJNZ	L49E4
	LD	A,#E5
	LD	(L4FC7),A
	RET

L49F1	LD	HL,(L4B8B)
	LD	DE,8
	ADD	HL,DE
	LD	(L4B8B),HL
	RET

L4A60	CALL	L4860
	LD	A,(L4B8D)
	XOR	#02
	JR	L4A78

L4A6D	CALL	L4860
	LD	A,(L4B8D)
	XOR	#01
L4A78	LD	(L4B8D),A
	RET

L4A7C	LD	HL,#0700
	LD	(L48D2),HL
L4A82	LD	B,#20
L4A84	CALL	L4FC5
	DJNZ	L4A84
	XOR	A
	LD	(L48D2),A
	RET

L4A8E	LD	A,(L4B8D)
	BIT	1,A
	JP	NZ,L5795
	JP	L554E

L4A99	LD	A,(L4B8D)
	BIT	0,A
	RET	Z
	LD	A,#23
	JR	L4AFC

L4AA3	LD	A,(HL)
	INC	HL
	BIT	7,A
	RES	7,A
	CALL	L4FC7
	JR	Z,L4AA3
	RET

L4AAF	LD	HL,L4B8D
	BIT	0,(HL)
	JP	NZ,L4B6D
	LD	H,0
	LD	L,A
	JR	L4AC4

L4ABC	LD	A,(L4B8D)
	BIT	0,A
	JP	NZ,L4B68
L4AC4	PUSH	BC
	LD	C,#01
	JR	L4ACC
L4AC9	PUSH	BC
	LD	C,0
L4ACC	PUSH	DE
	CALL	L4AD3
	POP	DE
	POP	BC
	RET

L4AD3	LD	DE,#2710
	CALL	L4AF0
	LD	DE,#03E8
	CALL	L4AF0
	LD	DE,#0064
	CALL	L4AF0
	LD	DE,#000A
	CALL	L4AF0
	LD	A,L
	ADD	A,#30
	JR	L4AFC
L4AF0	XOR	A
L4AF1	INC	A
	SBC	HL,DE
	JR	NC,L4AF1
	ADD	HL,DE
	CP	C
	RET	Z
	DEC	C
	ADD	A,#2F
L4AFC	JP	L4FC7

L4B60	LD	A,(L4B8D)
	BIT	0,A
	JR	Z,L4AC9
L4B68	LD	A,H
	CALL	L4B6D
	LD	A,L
L4B6D	PUSH	AF
	RRCA
	RRCA
	RRCA
	RRCA
	CALL	L4B76
	POP	AF
L4B76	AND	#0F
	ADD	A,#90
	DAA
	ADC	A,#40
	DAA
L4B80	JR	L4AFC

L4B83	LD	SP,(L4B89)
	EI
	RET

L4B89	DEFW	0
L4B8B	DEFW	0
L4B8D	DEFB	5
L4B8E	DEFB	7
L4B8F	DEFB	1
L4B90	DEFB	"ADR",#80+"="
L4B96	DEFB	" TYP",#80+"="
L4B9B	DEFB	" ERRO",#80+"R"
L4BA3	DEFB	" LEN",#80+"="
L4BA8	DEFB	"START",#80+"="
L4BAE	DEFB	" END",#80+"="
L4BB4	DEFB	" TO",#80+"="
L4BB8	DEFB	"JP",#80+"="
L4BBB	DEFB	"F",#80+":"
L4BBD	DEFB	"D",#80+":"
L4BBF	DEFB	"T",#80+":"
L4BC1	DEFB	"G",#80+":"
L4BC3	DEFB	"B",#80+":"
TXT_SEC	DEFB	" S",#80+":"
L4BD6	DEFB	"1=ADD:2=SUB:3=RL:4=RR:5=XOR:6=",#80+"N"
L4BF6	DEFB	#CD  ;CALL #5301 - return in FOXMON
	DEFW	L5301
L4BF9	DEFS	7

L4C60	LD	HL,L48D1
	LD	A,(HL)
	SUB	B
	LD	B,A
	DEC	(HL)
	INC	HL
	LD	A,(HL)
	SUB	B
	LD	(HL),A
	CALL	L4EEC
	LD	A,(L48D1)
	LD	B,A
	LD	A,#23
	CALL	L4FC7
	LD	HL,L4B8D
	SET	2,(HL)
	XOR	A
	LD	(L4FC4),A
	CALL	L4E6C
	LD	HL,L4BF9
L4C86	CALL	L4F60
	CP	#0C
	CALL	Z,L4E7D
	JR	Z,L4C86
	CP	#0D
	JR	Z,L4CB7
	CP	#30
	JP	C,L4E69
	CP	#47
	JP	NC,L4E69
	CP	#3A
	JR	C,L4CA7
	CP	#41
	JP	C,L4E69
L4CA7	LD	A,B
	OR	A
	JR	Z,L4C86
	LD	A,E
	CALL	L4FC7
	LD	(HL),A
	CALL	L4E6C
	INC	HL
	DEC	B
	JR	L4C86
L4CB7	LD	A,#48
	LD	(HL),A
	INC	HL
	CALL	L4EC5
	XOR	A
	LD	A,B
	RET

L4CC1	LD	A,#10
L4CC3	LD	(L48D1),A
	LD	B,A
	CALL	L4E6C
	LD	A,#01
	LD	(L4FC4),A
	LD	HL,L4B8D
	RES	2,(HL)
	LD	HL,L4DBD
L4CD7	CALL	L4F60
	CP	#0C	 ;DELETE
	CALL	Z,L4E7D	 ;DELETE OF CHAR
	JR	Z,L4CD7	 ;NEXT CHAR
	CP	#0D	 ;ENTER
	JR	Z,L4CFA	 ;ENTER	OF CHAR
	CP	#20	 ;SPACE
	JP	C,L4E69	 ;BAD CHAR
	LD	A,B
	OR	A
	JR	Z,L4CD7	 ;NEXT CHAR
	LD	A,E
	CALL	L4FC7
	LD	(HL),A
	CALL	L4E6C
	INC	HL
	DEC	B
	JR	L4CD7
L4CFA	LD	A,#80	 ;END OF LINE
	LD	(HL),A
	XOR	A
	RET

L4D60	CALL	L4A7C
	LD	HL,L4BA8
	CALL	L4AA3
	CALL	L4D67
	JR	C,ERR_1
	LD	(L4B8B),HL
	LD	HL,L4BAE
	CALL	L4AA3
	CALL	L4D67
	JR	C,ERR_1
	LD	(EN_ADR),HL
	CALL	L4A7C
NEXT_L	LD	B,100
NEXT_C	PUSH	BC
	LD	HL,(L4B8B)
	LD	DE,(EN_ADR)
	OR	A
	SBC	HL,DE
	JR	C,LP_1
	POP	BC
ERR_1	JP	L4A7C
LP_1	LD	B,8
	CALL	L4A8E
	CALL	COPY_1
	CALL	L49B1
	POP	BC
	DJNZ	NEXT_C

	CALL	L4A7C
	LD	A,">"
	CALL	L4FC7
PRESS_E	CALL	L4F8C
	CP	" "
	JR	Z,ERR_1
	CP	">"
	CALL	Z,RIGTAB
	CP	"<"
	CALL	Z,LEFTAB
	CP	"^"
	CALL	Z,ROLL_UP
	CP	13
	JR	Z,NEXT_L
	JR	PRESS_E

EN_ADR	DEFW	0

COPY_1	LD	B,8
LP7	LD	A," "
	CALL	OUTA
	DJNZ	LP7

	LD	HL,CODES
	CALL	GRAF

	LD	BC,0
LP0	PUSH	BC
	LD	D,8
LP1	PUSH	BC
	LD	A,B
	CALL	#22B0
	LD	B,A
	INC	B
	LD	A,(HL)
LP2	RLCA
	DJNZ	LP2
	RL	E
	POP	BC
	INC	B
	DEC	D
	JR	NZ,LP1
	LD	A,E
	CALL	OUTA
	INC	C
	LD	A,C
	JR	Z,EXIT_LP
	POP	BC
	LD	C,A
	JR	LP0

EXIT_LP	POP	BC
	LD	HL,CODES2
	JR	GRAF

EXIT2	LD	SP,L4DFF-2
	CALL	L4A7C
	LD	HL,L4B9B
	CALL	L4AA3
	CALL	L4F89
	JP	ERR_1

ROLL_UP	LD	B,100
ROLL_2	LD	HL,CODES3
	CALL	GRAF
	DJNZ	ROLL_2
	RET

OUTA	PUSH	AF
OUTA_1	CALL	#1F54
	JR	NC,EXIT2
	IN	A,(#7B)
	AND	#80
	JR	NZ,OUTA_1
	POP	AF
	OUT	(#FB),A
	OUT	(#7B),A
	OUT	(#FB),A
	RET

GRAF	LD	A,(HL)
	CP	#FF
	RET	Z
	CALL	OUTA
	INC	HL
	JR	GRAF

CODES	DEFB	#1B,"A",8,#1B,#2A,4,0,1,#FF
CODES2	DEFB	#D,#A,#FF
CODES3	DEFB	#1B,#6A,24,#FF

L4D67	LD	A,#05
L4D69	LD	(L48D1),A
	LD	B,A
	LD	A,(L4B8D)
	BIT	0,A
	JP	NZ,L4C60
	LD	A,B
L4D76	LD	B,A
	CALL	L4E6C
	XOR	A
	LD	(L4FC4),A
	LD	HL,L4B8D
	RES	2,(HL)
	LD	HL,L4BF9
L4D86	CALL	L4F60
	CP	#0C
	CALL	Z,L4E7D
	JR	Z,L4D86
	CP	#23
	JP	Z,L4C60
	CP	#0D
	JR	Z,L4DB0
	SUB	#30
	CP	#0A
	JP	NC,L4E69
	LD	A,B
	OR	A
	JR	Z,L4D86
	LD	A,E
	CALL	L4FC7
	LD	(HL),A
	CALL	L4E6C
	INC	HL
	DEC	B
	JR	L4D86
L4DB0	LD	A,#40
	LD	(HL),A
	PUSH	BC
	CALL	L4EA8
	POP	BC
	XOR	A
	DEC	A
	OR	A
	LD	A,B
	RET

L4E60	LD	DE,#8000
L4E63	DEC	DE
	LD	A,D
	OR	E
	JR	NZ,L4E63
	RET

L4E69	LD	A,E
	SCF
	RET

L4E6C	LD	A,#5F
	CALL	L4FC7
	CALL	L4FC5
	PUSH	HL
	LD	HL,L48D2
	DEC	(HL)
	DEC	(HL)
	POP	HL
	RET

L4E7D	LD	A,(L48D1)
	CP	B
	JR	NZ,L4E9A
	LD	A,(L4B8D)
	BIT	2,A
	JR	Z,L4EA6
	POP	HL
	LD	A,(L48D1)
	INC	A
	LD	(L48D1),A
	PUSH	AF
	CALL	L4E9C
	POP	AF
	JR	L4D76
L4E9A	INC	B
	DEC	HL
L4E9C	PUSH	HL
	LD	HL,L48D2
	DEC	(HL)
	POP	HL
	CALL	L4E6C
L4EA6	XOR	A
	RET

L4EA8	LD	HL,#0000
	LD	D,#00
	LD	IX,L4BF9
L4EB1	LD	A,(IX+0)
	SUB	#30
	CP	#0A
	RET	NC
	LD	B,H
	LD	C,L
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,BC
	ADD	HL,HL
	LD	E,A
	ADD	HL,DE
	INC	IX
	JR	L4EB1
L4EC5	LD	IX,L4BF9
	XOR	A
	LD	(HL),A
	INC	HL
	LD	(HL),A
	DEC	HL
L4ECE	LD	A,(IX+0)
	CP	#47
	JR	NC,L4EE7
	SUB	#30
	CP	#0A
	JR	C,L4EDD
	SUB	#07
L4EDD	RLD
	INC	HL
	RLD
	DEC	HL
	INC	IX
	JR	L4ECE
L4EE7	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
	RET

L4EEC	PUSH	AF
	LD	B,A
	LD	A,#20
	SUB	B
	LD	B,A
L4EF2	CALL	L4FC5
	DJNZ	L4EF2
	POP	AF
	LD	(L48D2),A
	RET

L4F60	PUSH	HL
	PUSH	BC
	CALL	L4F89
	PUSH	AF
	LD	BC,#FFFD
	IN	A,(C)
	LD	B,#BF
	OUT	(C),A
	DEC	A
	JR	Z,L4F83
	LD	DE,#0032
	LD	HL,#0100
	LD	IX,#03D1
	LD	B,L
	XOR	A
	DI
	CALL	#03CF
L4F83	DI
	POP	AF
	LD	E,A
	POP	BC
	POP	HL
	RET

L4F89	CALL	L4E60
L4F8C	LD	IY,L4F94
L4F90	CALL	#028E
	JR	NZ,L4F90
L4F94	EQU	$-1
	PUSH	AF
	LD	A,#28
	CP	E
	SET	3,(IY+48)
	JR	Z,L4FA3
	RES	3,(IY+48)
L4FA3	POP	AF
	CALL	#031E
	JR	NC,L4F90
	LD	E,A
	LD	C,#00
	LD	D,#08
	CALL	#0333
	CP	#7B
	JR	NC,L4F90
	BIT	0,(IY+48)
	LD	IY,#5C3A
	RET	NZ
	CP	#61
	RET	C
	SUB	#20
	RET

L4FC4	DEFB	#00

L4FC5	LD	A,#20
L4FC7	PUSH	HL
	PUSH	BC
	PUSH	DE
	PUSH	AF
	LD	HL,(L48D2)
	LD	A,L
	CP	#20
L4FD0	EQU	$-1
	JR	NC,L4FFB
	INC	L
	LD	(L48D2),HL
	DEC	L
	LD	A,H
	LD	C,L
	EX	DE,HL
	CALL	#E9F
	EX	DE,HL
	LD	A,E
	ADD	A,C
	LD	E,A
	POP	AF
	PUSH	AF
	LD	BC,#3C00
	LD	H,C
	LD	L,A
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,BC
	LD	B,#08
L4FF4	LD	A,(HL)
L4FF5	NOP
	LD	(DE),A
	INC	HL
	INC	D
	DJNZ	L4FF4
L4FFB	POP	AF
	POP	DE
	POP	BC
	POP	HL
	RET

L5000	LD	HL,(L4B8B)
	LD	DE,8
	OR	A
	SBC	HL,DE
	LD	(L4B8B),HL
	RET

L500D	CALL	L4A7C
	LD	HL,(L4B8B)
	PUSH	HL
L501A	LD	HL,#0700
	LD	A,L
	LD	(L48D2),HL
	CALL	L4EEC
	POP	HL
	PUSH	HL
	CALL	L4A99
	CALL	L4B60
	LD	A,#2C
	CALL	L4FC7
	CALL	L4D67
	POP	DE
	JR	C,L50AA
	CALL	L4FC5
	EX	DE,HL
	LD	A,D
	OR	A
	LD	(HL),E
	INC	HL
	JR	Z,L5044
	LD	(HL),D
	INC	HL
L5044	PUSH	HL
	LD	B,7
	CALL	L4A8E
	JR	L501A

L504C	CALL	L4A7C
	OR	A
	EX	AF,AF'
	CALL	L50CF
	CALL	L4FC5
	JR	C,L50AA
	PUSH	DE
	PUSH	DE
	PUSH	HL
	LD	IX,L48D0
	LD	DE,#0001
	XOR	A
	SCF
	EX	AF,AF'
	CALL	#0562
	POP	DE
	POP	IX
	CALL	#05A9
	LD	A,#00
	OUT	(#FE),A
	POP	DE
	JR	C,L5098
	PUSH	AF
	CALL	L4A7C
	POP	AF
	JR	NZ,L50AD
	PUSH	IX
	LD	HL,L4B9B
	CALL	L4AA3
	CALL	L4AA3
	POP	HL
	DEC	HL
	SBC	HL,DE
	CALL	L4A99
	CALL	L4ABC
L5098	LD	HL,L4B96
	CALL	L4AA3
	CALL	L4A99
	LD	A,(L48D0)
	CALL	L4AAF
	CALL	L4F8C
L50AA	JP	L5171

L50AD	LD	HL,L4B9B
	CALL	L4AA3
	JR	L5098

L50CF	CALL	L4D67
	RET	C
	PUSH	HL
	LD	A,#2C
	CALL	L4FC7
	CALL	L4D67
	POP	DE
	RET	C
	EX	AF,AF'
	RET	NC
	PUSH	DE
	PUSH	HL
	LD	HL,L4B96
	CALL	L4AA3
	LD	A,3
	CALL	L4D69
	CALL	L4FC5
	POP	DE
	POP	IX
	LD	A,L
	RET

L50F5	CALL	L4A7C
	LD	HL,L4BA8
	CALL	L4AA3
	CALL	L4D67
	JR	C,L5171
	PUSH	HL
	LD	HL,L4BAE
	CALL	L4AA3
	CALL	L4D67
	POP	DE
	JR	C,L5171
	PUSH	DE
	PUSH	HL
	CALL	L4A7C
	LD	HL,L4BD6
	CALL	L4AA3
L511B	CALL	L4F8C
	LD	C,#80
	CP	#31
	JR	Z,L5142
	LD	C,#90
	CP	#32
	JR	Z,L5142
	LD	C,#07
	CP	#33
	JR	Z,L515F
	LD	C,#0F
	CP	#34
	JR	Z,L515F
	LD	C,#A8
	CP	#35
	JR	Z,L5142
	LD	C,#78
	CP	#36
	JR	NZ,L511B
L5142	PUSH	BC
	PUSH	AF
	CALL	L4A7C
	LD	A,#4B
	CALL	L4FC7
	POP	AF
	CALL	L4FC7
	LD	A,#3D
	CALL	L4FC7
	LD	A,#03
	CALL	L4D69
	CALL	L4FC5
	POP	BC
	LD	B,L
L515F	POP	DE
	POP	HL
	JR	C,L5171
	LD	A,C
	LD	(L5168),A
L5167	LD	A,(HL)
L5168	NOP
	LD	(HL),A
	OR	A
	SBC	HL,DE
	ADD	HL,DE
	INC	HL
	JR	NZ,L5167
L5171	JP	L4A7C

L5174	CALL	L4A7C
	LD	HL,L4BA8
	CALL	L4AA3
	CALL	L4D67
	JR	C,L51B5
	PUSH	HL
	LD	HL,L4BB4
	CALL	L4AA3
	CALL	L4D67
	POP	DE
	JR	C,L51B5
	PUSH	DE
	PUSH	HL
	LD	HL,L4BA3
	CALL	L4AA3
	CALL	L4D67
	CALL	L4FC5
	LD	B,H
	LD	C,L
	POP	DE
	POP	HL
	JR	C,L51B5
	OR	A
	SBC	HL,DE
	ADD	HL,DE
	JR	C,L51AD
	LDIR
	JR	L51B5
L51AD	ADD	HL,BC
	EX	DE,HL
	ADD	HL,BC
	EX	DE,HL
	DEC	HL
	DEC	DE
	LDDR
L51B5	JR	L5171

L51B8	CALL	L4A7C
	LD	HL,L4BBD
	CALL	L4AA3
	CALL	L4D67
	JR	NC,L51DE
	CP	#2B
	JR	Z,L51D8
	CP	#2D
	JR	NZ,L51EC
	CALL	L51EF
	JR	C,L51EC
	OR	A
	SBC	HL,DE
	JR	L51DE
L51D8	CALL	L51EF
	JR	C,L51EC
	ADD	HL,DE
L51DE	LD	A,#3D
	CALL	L4FC7
	CALL	L4A99
	CALL	L4ABC
	CALL	L4F89
L51EC	JP	L51B5
L51EF	CALL	L4FC7
	LD	A,(L4B8D)
	BIT	2,A
	JR	NZ,L51FE
	CALL	L4DB0
	JR	L5201
L51FE	CALL	L4CB7
L5201	PUSH	HL
	CALL	L4D67
	POP	DE
	EX	DE,HL
	RET

L5208	CALL	L4A7C
	LD	HL,L4BBF
	CALL	L4AA3
	CALL	L4CC1
	JR	C,L51EC
	LD	HL,(L4B8B)
	LD	DE,L4DBD
L521D	LD	A,(DE)
	CP	#80
	JR	NC,L51EC
	LD	(HL),A
	INC	HL
	INC	DE
	JR	L521D

L5228	CALL	L4A7C
	LD	HL,L4BBB
	CALL	L4AA3
	CALL	L4CC1
	JR	C,L5242
	LD	A,#10
	SUB	B
	LD	(L4B8F),A
	CALL	L4FC5
	CALL	L52A1
L5242	JP	L51EC

L5245	CALL	L5288
	LD	A,#40
	LD	(L4FD0),A
	LD	HL,L4BC1
	CALL	L4AA3
	LD	C,#10
	LD	DE,L4DBD
L5258	PUSH	BC
	PUSH	DE
	CALL	L4D67
	POP	DE
	POP	BC
	JR	C,L5288
	LD	B,A
	LD	A,(L48D1)
	CP	B
	JR	Z,L527C
	LD	A,#2C
	CALL	L4FC7
	LD	A,L
	LD	(DE),A
	INC	DE
	DEC	C
	JR	Z,L527C
	LD	A,H
	OR	A
	JR	Z,L5258
	LD	(DE),A
	INC	DE
	DEC	C
	JR	NZ,L5258
L527C	LD	A,#10
	SUB	C
	LD	(L4B8F),A
	CALL	L4FC5
	CALL	L52A1
L5288	LD	HL,#0600
	PUSH	HL
	CALL	L5291
	POP	HL
	INC	H
L5291	LD	(L48D2),HL
	CALL	L4A82
	DEC	H
	LD	(L48D2),HL
	LD	A,#20
	LD	(L4FD0),A
	RET

L52A1	LD	HL,(L4B8B)
	INC	HL
	LD	BC,#FFFF
L52A8	LD	A,(L4B8F)
	LD	(L48D1),A
	LD	DE,L4DBD
	LD	A,(DE)
	CPIR
	PUSH	HL
L52B5	LD	A,(L48D1)
	DEC	A
	LD	(L48D1),A
	JR	Z,L52C7
	INC	DE
	LD	A,(DE)
	CPI
	JR	Z,L52B5
	POP	HL
	JR	L52A8
L52C7	POP	HL
	DEC	HL
	LD	(L4B8B),HL
	RET

L52CD	CALL	L4A7C
	LD	HL,L4BB8
	CALL	L4AA3
	CALL	L4D67
	JR	C,L52E4
	CALL	L4FC5
	LD	SP,(L4B89)
	EI
	JP	(HL)
L52E4	CALL	L4A7C
	JP	L48A0

L52EA	LD	HL,(L4B8B)
	PUSH	HL
	LD	DE,L4BF6
	LD	BC,#0003
	LDIR
	POP	HL
	LD	DE,L5301
	LD	(HL),#CD
	INC	HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	RET
L5301	DI
	POP	DE
	DEC	DE
	DEC	DE
	DEC	DE
	LD	(L4B89),SP
	LD	SP,L4DFF
	LD	HL,L4BF6
	LD	BC,#0003
	LDIR
	JP	L489D

L4DBD	DEFS #36  ;STACK OF SEARCH MODE
L4DFF		  ;BEGIN OF STACK MONITOR

L5318	DEFB	#E0,#0A,#0E
	DEFB	#0F,#96,#AF
	DEFB	#B4,#B9,#BE
	DEFB	#BD,#C5,#09
	DEFB	"L",#C4,#04
	DEFB	#C5,",",#85
	DEFB	#00,#08,#0C
	DEFB	"%","*","U"
	DEFB	"\","i","k"
	DEFB	#09,"R","E"
	DEFB	#D4,#A4,"/"
	DEFB	#09,"P","O"
	DEFB	#D0,#94,#9A
	DEFB	"R","E",#D4
	DEFB	"E","X",#D8
	DEFB	"J","P"," "
	DEFB	"(","K",#A9
	DEFB	"L","D"," "
	DEFB	"S","P",","
	DEFB	#CB,#09,"J"
	DEFB	#D0,"$",#C1
	DEFB	#D7,#BA,"J"
	DEFB	"P"," ",#D7
	DEFB	#A0,"O","U"
	DEFB	"T"," ","("
	DEFB	"V",")",","
	DEFB	#C1,"I","N"
	DEFB	" ","A",","
	DEFB	"(","V",#A9
	DEFB	"E","X"," "
	DEFB	"(","S","P"
	DEFB	")",",",#CB
	DEFB	"E","X"," "
	DEFB	"D","E",","
	DEFB	"H",#CC,"D"
	DEFB	#C9,"E",#C9
	DEFB	#09,"C","A"
	DEFB	"L",#CC,"$"
	DEFB	#C1,#D7,"7"
	DEFB	#09,"P","U"
	DEFB	"S",#C8,#94
	DEFB	#81,"C","A"
	DEFB	"L","L"," "
	DEFB	#D7,",",#81
	DEFB	#D6,#09,"R"
	DEFB	"S",#D4,#BA
	DEFB	"0",#B0,"0"
	DEFB	#B8,"1",#B0
	DEFB	"1",#B8,"2"
	DEFB	#B0,"2",#B8
	DEFB	"3",#B0,"3"
	DEFB	#B8,":","R"
	DEFB	"L",#C3,"R"
	DEFB	"R",#C3,"R"
	DEFB	#CC,"R",#D2
	DEFB	"S","L",#C1
	DEFB	"S","R",#C1
	DEFB	"S","L",#C9
	DEFB	"S","R",#CC
	DEFB	#01,#A0,#85
	DEFB	#09,"B","I"
	DEFB	#D4,#1C,#C5
	DEFB	#09,"R","E"
	DEFB	#D3,#1C,#C5
	DEFB	#09,"S","E"
	DEFB	#D4,#1C,#C5
	DEFB	#00,#B4,#BB
	DEFB	#C3,#D1,#DE
	DEFB	#E1,#E9,#F0
	DEFB	#1B,"L",#C4
	DEFB	"C",#D0,"I"
	DEFB	#CE,"O",#D4
	DEFB	#06,#9A,#C9
	DEFB	#C4,"I",#D2
	DEFB	"D",#D2,#00
	DEFB	#08,"%","2"
	DEFB	"a","k","o"
	DEFB	"s","x","6"
	DEFB	#09,"J",#D2
	DEFB	"$",#C1,#AA
	DEFB	#9A,"N","O"
	DEFB	#D0,"E","X"
	DEFB	" ","A","F"
	DEFB	",","A","F"
	DEFB	#A7,"D","J"
	DEFB	"N","Z"," "
	DEFB	#AA,"J","R"
	DEFB	" ",#AA,"7"
	DEFB	#09,"L",#C4
	DEFB	#0C,#C1,#D7
	DEFB	#01,"A","D"
	DEFB	"D"," ",#CB
	DEFB	#CC,#09,"L"
	DEFB	#C4,#BA,"("
	DEFB	"B","C",")"
	DEFB	",",#C1,"A"
	DEFB	",","(","B"
	DEFB	"C",#A9,"("
	DEFB	"D","E",")"
	DEFB	",",#C1,"A"
	DEFB	",","(","D"
	DEFB	"E",#A9,"("
	DEFB	"W",")",","
	DEFB	#CB,"K",","
	DEFB	"(","W",#A9
	DEFB	"(","W",")"
	DEFB	",",#C1,"A"
	DEFB	",","(","W"
	DEFB	#A9,"/",#09
	DEFB	"I","N",#C3
	DEFB	#8C,#09,"D"
	DEFB	"E",#C3,#8C
	DEFB	#09,"I","N"
	DEFB	#C3,#84,#09
	DEFB	"D","E",#C3
	DEFB	#84,#09,"L"
	DEFB	#C4,#04,#C1
	DEFB	#D6,#BA,"R"
	DEFB	"L","C",#C1
	DEFB	"R","R","C"
	DEFB	#C1,"R","L"
	DEFB	#C1,"R","R"
	DEFB	#C1,"D","A"
	DEFB	#C1,"C","P"
	DEFB	#CC,"S","C"
	DEFB	#C6,"C","C"
	DEFB	#C6,#09,"I"
	DEFB	#CE,#04,#C1
	DEFB	"(","C",#A9
	DEFB	#01,"O","U"
	DEFB	"T"," ","("
	DEFB	"C",#A9,#C4
	DEFB	"?",#01,"S"
	DEFB	"B","C"," "
	DEFB	#CB,#CC,#01
	DEFB	"A","D","C"
	DEFB	" ",#CB,#CC
	DEFB	#09,"L",#C4
	DEFB	"/",#01,"("
	DEFB	"W",#A9,#CC
	DEFB	#0C,#C1,"("
	DEFB	"W",#A9,#81
	DEFB	"N","E",#C7
	DEFB	#01,"R","E"
	DEFB	#D4,#17,#81
	DEFB	#CE,#81,#C9
	DEFB	#09,"I",#CD
	DEFB	#9A,#B0,#AD
	DEFB	#B1,#B2,">"
	DEFB	#8A,"R","R"
	DEFB	#C4,"R","L"
	DEFB	#C4,#09,"L"
	DEFB	#C4,#9A,"I"
	DEFB	",",#C1,"R"
	DEFB	",",#C1,"A"
	DEFB	",",#C9,"A"
	DEFB	",",#D2
L54EE	DEFB	6,#0F,#15,#1B
	DEFB	#22,"-",#C2
	DEFB	#C3,#C4,#C5
	DEFB	#C8,#CC,"("
	DEFB	"Q",#A9,#C1
	DEFB	"B",#C3,"D"
	DEFB	#C5,#CB,"S"
	DEFB	#D0,"B",#C3
	DEFB	"D",#C5,#CB
	DEFB	"A",#C6,#B0
	DEFB	#B1,#B2,#B3
	DEFB	#B4,#B5,#B6
	DEFB	#B7,"N",#DA
	DEFB	#DA,"N",#C3
	DEFB	#C3,"P",#CF
	DEFB	"P",#C5,#D0
	DEFB	#CD,"A","D"
	DEFB	"D"," ","A"
	DEFB	#AC,"A","D"
	DEFB	"C"," ","A"
	DEFB	#AC,"S","U"
	DEFB	"B",#A0,"S"
	DEFB	"B","C"," "
	DEFB	"A",#AC,"A"
	DEFB	"N","D",#A0
	DEFB	"X","O","R"
	DEFB	#A0,"O","R"
	DEFB	#A0,"C","P",#A0
L5544	DEFB	"H","A"
	DEFB	"L",#D4
L5548	DEFB	"H",#CC,"I",#D8
	DEFB	"I",#D9

L554E	LD	HL,(L4B8B)
	PUSH	HL
	LD	HL,#0000
L5555	LD	(L48D2),HL
	PUSH	HL
	PUSH	BC
	CALL	L556C
	POP	BC
	POP	HL
	INC	H
	DJNZ	L5555
	POP	HL
	LD	(L4B8B),HL
	LD	DE,#0898
	JP	L4E63
L556C	XOR	A
	LD	HL,L48D0
	LD	(HL),A
	INC	HL
	LD	(HL),A
	INC	HL
	LD	(HL),A
	LD	A,#11
	LD	(L48D5),A
	LD	HL,(L4B8B)
	CALL	L4B60
	LD	A,(L48D2)
	INC	A
	LD	(L48D4),A
	LD	DE,#0000
	CALL	L55E4
	LD	A,(L48D4)
	LD	(L48D2),A
	LD	B,A
	LD	A,#10
	SUB	B
	JR	Z,L559C
	CALL	L55A7
L559C	LD	A,(L48D5)
	LD	(L48D2),A
	LD	B,A
	LD	A,#20
	SUB	B
	RET	Z
L55A7	LD	B,A
L55A8	CALL	L4FC5
	DJNZ	L55A8
	RET
L55AE	PUSH	HL
	LD	A,(L48D4)
	LD	(L48D2),A
	LD	HL,(L4B8B)
	LD	A,(HL)
	INC	HL
	LD	(L4B8B),HL
	PUSH	AF
	CALL	L4B6D
	LD	A,(L48D2)
	LD	(L48D4),A
	POP	AF
	POP	HL
	RET
L55CA	LD	HL,L48D4
	DEC	(HL)
	DEC	(HL)
	LD	HL,(L4B8B)
	DEC	HL
	LD	(L4B8B),HL
	DJNZ	L55CA
	LD	A,#3F
	JP	L56F3
L55DD	INC	D
L55DE	INC	D
	LD	A,D
	CP	#03
	JR	NC,L55CA
L55E4	CALL	L55AE
	LD	B,#01
	CP	#76
	JP	Z,L5685
	CP	#DD
	JR	Z,L55DE
	CP	#FD
	JR	Z,L55DD
	CP	#CB
	JR	Z,L55FF
	CP	#ED
	JR	NZ,L563C
	INC	E
L55FF	INC	E
	LD	A,E
	LD	(L48D1),A
	XOR	A
	OR	D
	JR	NZ,L5612
	LD	A,E
	CP	#01
	JR	NZ,L561D
	CALL	L55AE
	JR	L563C
L5612	LD	A,E
	CP	#02
	JR	Z,L55CA
	CALL	L55AE
	LD	(L48D0),A
L561D	CALL	L55AE
	LD	C,A
	LD	A,E
	CP	#01
	JR	NZ,L5631
	LD	B,#03
	LD	A,C
	AND	#07
	CP	#06
	JR	NZ,L55CA
	JR	L563B
L5631	LD	A,#3F
	CP	C
	JR	NC,L55CA
	LD	A,#BB
	CP	C
	JR	C,L55CA
L563B	LD	A,C
L563C	LD	(L4B8E),A
	RLA
	RL	E
	RLA
	RL	E
	LD	A,E
	LD	HL,L5318
	CALL	L5673
L564C	LD	A,(HL)
	INC	HL
	LD	BC,L5664
	PUSH	BC
	PUSH	HL
	PUSH	AF
	LD	HL,L5669
	CALL	L5671
	POP	AF
	RRCA
	RRCA
	RRCA
	LD	E,A
	EX	(SP),HL
	LD	A,(L4B8E)
	RET
L5664	BIT	4,E
	JR	Z,L564C
	RET
L5669	EX	AF,AF'
	DJNZ	L56A0
	LD	(HL),#46
	LD	C,B
	LD	H,B
	LD	E,B
L5671	AND	#07
L5673	LD	C,A
	LD	B,#00
	ADD	HL,BC
	LD	C,(HL)
	ADD	HL,BC
	RET
L567A	CALL	L5688
	BIT	0,E
	RET	Z
	LD	A,#20
	JP	L56F3
L5685	LD	HL,L5544
L5688	BIT	3,E
	RES	3,E
	LD	A,#2C
	CALL	NZ,L56F3
L5691	LD	A,(HL)
	BIT	7,A
	RES	7,A
	PUSH	AF
	CALL	NC,L56DF
	INC	HL
	POP	AF
	JR	Z,L5691
	RET
L569F	RRA
L56A0	RRA
	RRA
	AND	#07
	LD	C,A
	LD	A,E
	AND	#07
L56A8	LD	B,A
	INC	B
L56AA	XOR	A
	CP	C
	CALL	L5688
	DEC	C
	DJNZ	L56AA
	RET
L56B3	RRA
	RRA
	RRA
	PUSH	HL
	LD	HL,L54EE
	PUSH	AF
	LD	A,E
	CALL	L5671
	POP	AF
	AND	#07
	LD	C,A
	CALL	L56A8
	POP	HL
	RET
L56C8	RRCA
	XOR	#04
	BIT	2,A
	JR	L56D1
L56CF	BIT	5,A
L56D1	RES	5,A
	LD	(L4B8E),A
	RET	NZ
	LD	A,E
	AND	#07
	LD	C,A
	LD	B,#00
	ADD	HL,BC
	RET
L56DF	CP	#4B
	JR	Z,L5733
	CP	#51
	JR	Z,L5741
	CP	#56
	JR	Z,L5702
	CP	#57
	JR	Z,L5719
	CP	#2A
	JR	Z,L5767
L56F3	PUSH	AF
	LD	A,(L48D5)
	LD	(L48D2),A
	INC	A
	LD	(L48D5),A
	POP	AF
	JP	L4FC7
L5702	CALL	L55AE
	PUSH	HL
	PUSH	AF
	LD	A,(L48D5)
	LD	(L48D2),A
	POP	AF
	CALL	L4AAF
	LD	A,(L48D2)
	LD	(L48D5),A
	POP	HL
	RET
L5719	CALL	L55AE
	PUSH	HL
	LD	L,A
	CALL	L55AE
	LD	H,A
	LD	A,(L48D5)
	LD	(L48D2),A
	CALL	L4B60
	LD	A,(L48D2)
	LD	(L48D5),A
	POP	HL
	RET
L5733	PUSH	HL
	PUSH	BC
	LD	HL,L5548
	LD	C,D
	LD	B,#03
	CALL	L56AA
	POP	BC
	POP	HL
	RET
L5741	CALL	L5733
	LD	A,D
	OR	A
	RET	Z
	LD	A,#2B
	CALL	L56F3
	LD	A,(L48D1)
	DEC	A
	JR	NZ,L5702
	PUSH	HL
	LD	A,(L48D5)
	LD	(L48D2),A
	LD	A,(L48D0)
	CALL	L4AAF
	LD	A,(L48D2)
	LD	(L48D5),A
	POP	HL
	RET
L5767	PUSH	DE
	CALL	L55AE
	LD	HL,(L4B8B)
	DEC	HL
	CP	#80
	JR	C,L578E
	LD	E,A
	LD	A,#FF
	SUB	E
	LD	E,A
	LD	D,#00
	OR	A
	SBC	HL,DE
L577D	LD	A,(L48D5)
	LD	(L48D2),A
	CALL	L4B60
	POP	DE
	LD	A,(L48D2)
	LD	(L48D5),A
	RET
L578E	INC	A
	LD	E,A
	LD	D,#00
	ADD	HL,DE
	JR	L577D
L5795	LD	HL,(L4B8B)
	LD	DE,#0000
L579B	LD	(L48D2),DE
	PUSH	DE
	PUSH	BC
	CALL	L57B3
	CALL	L4FC5
	POP	BC
	POP	DE
	INC	D
	INC	HL
	DJNZ	L579B
	LD	DE,#15E0
	JP	L4E63
L57B3	PUSH	HL
	CALL	L4B60
	LD	A,#08
	LD	(L48D2),A
	POP	HL
	PUSH	HL
	LD	A,(HL)
	CALL	L4AAF
	CALL	L4FC5
	CALL	L4FC7
	LD	A,#0E
	LD	(L48D2),A
	POP	HL
	PUSH	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
	CALL	L4ABC
	LD	A,(L48D2)
	LD	B,A
	LD	A,#14
	SUB	B
	LD	B,A
L57DE	CALL	L4FC5
	DJNZ	L57DE
	LD	A,#16
	LD	(L48D2),A
	POP	HL
	LD	A,(HL)
	CP	#80
	JR	C,L57F6
	LD	A,#2F
	LD	(L4FF5),A
	LD	A,(HL)
	AND	#7F
L57F6	CP	#20
	CALL	NC,L4FC7
	XOR	A
	LD	(L4FF5),A
	RET

	ENT

LEN_PROG	EQU	$-PROG

