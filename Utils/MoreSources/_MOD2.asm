	ORG	64000
;
ATR_1	EQU	#588A
ATR_2	EQU	#58AA
ATR_LIN	EQU	#5940
;STAR	LD	HL,#5CB2
;	LD	(HL),START-1
LF8C0	CALL	LFA81
;	XOR	A
;	LD	(#5C8C),A
;	LD	B,#16
;F8C9	LD	A,#0D
;	RST	#10
;	DJNZ	LF8C9
;F8CE	LD	BC,#FBFE
;	IN	A,(C)
;	BIT	4,A
;	JR	Z,LF8C0
;	BIT	3,A
;	JR	Z,LF8C0
;	CALL	LFB4B
;	JR	NZ,LF8CE
;	RET
;
	CP	"q"
	RET	Z
LOOPI	CALL	LFA87
	AND	A
	JR	Z,LOOPI
	CP	"t"
	JR	Z,LF8C0
	CP	"r"
	JR	Z,LF8C0
	CP	"q"
	JR	NZ,LOOPI
	RET
;
LF8E1	LD	HL,ATR_2
	LD	A,(HL)
	CP	#78
	JR	Z,LF8FA
	CALL	LF913
	LD	A,#78
	CALL	LF90D
	LD	A,#38
	INC	HL
	INC	HL
	CALL	LF90B
	XOR	A
	RET
;
LF8FA	CALL	LF93F
	LD	A,#38
	CALL	LF90D
	LD	A,#78
	INC	HL
	INC	HL
	CALL	LF90B
	XOR	A
	RET
;
LF90B	LD	(HL),A
	INC	HL
LF90D	LD	(HL),A
	INC	HL
	LD	(HL),A
	INC	HL
	LD	(HL),A
	RET
;
LF913	LD	A,#02
	LD	(LFC8E),A
	LD	A,#04
	LD	(LFCA3),A
	LD	A,#02
	LD	(LFBED),A
	LD	A,#F5
	LD	(LFBF4),A
	LD	A,#81
	LD	(LFC00),A
	LD	A,#CD
	LD	(LFBFA),A
	LD	(LFC06),A
	LD	A,#B9
	LD	(LFC0C),A
	LD	A,#96
	LD	(LF9CA),A
	RET
;
LF93F	LD	A,#01
	LD	(LFC8E),A
	LD	A,#02
	LD	(LFCA3),A
	LD	A,#01
	LD	(LFBED),A
	LD	A,#14
	LD	(LFBF4),A
	LD	A,#46
	LD	(LFC00),A
	LD	A,#3A
	LD	(LFBFA),A
	LD	(LFC06),A
	LD	A,#7D
	LD	(LFC0C),A
	LD	A,#1E
	LD	(LF9CA),A
	RET
;
LF96B	LD	HL,ATR_1
	LD	A,(HL)
	CP	#78
	JR	Z,LF984
	CALL	LF995
	LD	A,#78
	CALL	LF90D
	LD	A,#38
	INC	HL
	INC	HL
	CALL	LF90B
	XOR	A
	RET
;
LF984	CALL	LF9AF
	LD	A,#38
	CALL	LF90D
	LD	A,#78
	INC	HL
	INC	HL
	CALL	LF90B
	XOR	A
	RET
;
LF995	LD	A,#E4
	LD	(LFC71),A
	LD	A,#EC
	LD	(LFC74),A
	LD	A,#EA
	LD	(LFBD6),A
	LD	A,#E2
	LD	(LFBDD),A
	LD	A,#0A
	LD	(LF9C9),A
	RET
;
LF9AF	LD	A,#E4
	LD	(LFC74),A
	LD	A,#EC
	LD	(LFC71),A
	LD	A,#EA
	LD	(LFBDD),A
	LD	A,#E2
	LD	(LFBD6),A
	LD	A,#09
	LD	(LF9C9),A
	RET
;
LF9C9	DEFB	#0A
LF9CA	DEFB	#1E
;
LF9CB
	LD	A,2
	CALL	#1601
	LD	DE,T_MAIN
LF9D3	LD	A,(DE)
	CP	#00
	JR	Z,LF9E0
	CP	#01
	JR	Z,LFA30
	CP	2
	RET	Z
	RST	#10
	INC	DE
	JR	LF9D3
;
LF9E0	LD	A,(LF9CA)
	CP	#1E
	JR	Z,LF9EC
	CALL	LF8E1
	JR	LF9F2
;
LF9EC	LD	HL,ATR_2
	CALL	LF8FA
LF9F2	LD	A,(LF9C9)
	CP	#09
	JR	Z,LF9FE
	CALL	LF96B
	JR	LFA04
;
LF9FE	LD	HL,ATR_1
	CALL	LF984
LFA04	CALL	LFA87
	CP	"t"
	JR	Z,LFA22
	CP	"b"
	CALL	Z,LF8E1
	CP	"p"
	CALL	Z,LF96B
	CP	#00
	JR	Z,LFA04
	CP	"r"
	JR	Z,LFA29
	CP	"q"
	RET	Z
	JR	LFA81
;
LFA22	LD	DE,T_TRANS
	LD	C,#00
	JR	LF9D3
;
LFA29	LD	DE,T_RECEI
	LD	C,#01
	JR	LF9D3
;
LFA30	LD	HL,#0000
LFA33	CALL	LFA87
	CP	#0C
	JR	Z,LFA81
	CP	#0D
	JR	Z,LFA65
	PUSH	AF
	RST	#10
	POP	AF
	CP	#2C
	JR	Z,LFA59
	SUB	#30
	CP	#0A
	JP	P,LFA81
	PUSH	HL
	POP	DE
	LD	B,#09
LFA50	ADD	HL,DE
	DJNZ	LFA50
	LD	D,#00
	LD	E,A
	ADD	HL,DE
	LD	A,(JACH)
	INC	A
	LD	(JACH),A
	CP	6
	JP	Z,LFA81
	JR	LFA33
;
JACH	DEFB	0
;
LFA59	LD	(LFC26),HL
	XOR	A
	LD	(JACH),A
	LD	A,C
	CP	#00
	LD	C,#0A
	JR	Z,LFA30
	JR	LFA81
;
LFA65	PUSH	AF
	LD	DE,ATR_LIN
	LD	B,#20
	LD	A,#78
LFA6D	LD	(DE),A
	INC	DE
	DJNZ	LFA6D
	POP	AF
	LD	A,C
	CP	#0A
	PUSH	AF
	CALL	Z,LFAF1
	POP	AF
	JP	Z,LFC17
	CP	#01
	JR	Z,LFA96
LFA81
	XOR	A
	LD	(JACH),A
	CALL	#0DAF
	JP	LF9CB
;
LFA87	PUSH	HL
	LD	HL,#5C3B
LFA8B	BIT	5,(HL)
	JR	Z,LFA8B
	LD	A,(#5C08)
	RES	5,(HL)
	POP	HL
	RET
;
LFA96	DI
	LD	B,#00
	CALL	LFB55
	CALL	LFB64
	PUSH	BC
	LD	A,#2C
	RST	#10
	XOR	A
	CALL	LFABD
	LD	DE,T_ERROR
	CALL	LF9D3
;	LD	A," "
;	RST	#10
;	LD	A,"E"
;	RST	#10
;	LD	A,"R"
;	RST	#10
;	LD	A,"R"
;	RST	#10
;	LD	A,"O"
;	RST	#10
;	LD	A,"R"
;	RST	#10
;	LD	A," "
;	RST	#10
	POP	HL
LFABD	LD	DE,#0001
	PUSH	DE
	LD	DE,#000A
	PUSH	DE
	LD	DE,#0064
	PUSH	DE
	LD	DE,#03E8
	PUSH	DE
	LD	DE,#2710
	PUSH	DE
	LD	B,#05
LFAD3	XOR	A
	POP	DE
LFAD5	PUSH	HL
	SBC	HL,DE
	JP	M,LFAE1
	INC	A
	EX	AF,AF'
	POP	AF
	EX	AF,AF'
	JR	LFAD5
;
LFAE1	ADD	A,#30
	POP	HL
	RST	#10
	DJNZ	LFAD3
	RET
;
LFAF1	LD	DE,(LFC26)
	ADD	HL,DE
	LD	(LFC2C),HL
	RET
;
LFB03	LD	IX,(#5C0B)
	LD	L,(IX+4)
	LD	H,(IX+5)
	LD	E,(IX+12)
	LD	D,(IX+13)
	RET
;
LFB4B	PUSH	BC
	LD	BC,#7FFE
	IN	A,(C)
	BIT	0,A
	POP	BC
	RET
;
LFB55	CALL	LFB4B
	RET	Z
	IN	A,(#EF)
	AND	#80
	CP	E
	JR	Z,LFB55
	LD	E,A
	DJNZ	LFB55
	RET
;
LFB64	PUSH	IX
	PUSH	IY
	PUSH	HL
	POP	IX
	LD	IY,#0000
LFB6F	PUSH	HL
	LD	HL,#0000
	LD	BC,#0000
LFB76	LD	D,#80
	IN	A,(#EF)
	AND	#80
LFB7C	LD	E,A
	LD	B,#00
LFB7F	IN	A,(#EF)
	AND	#80
	CP	E
	JR	NZ,LFB97
	DJNZ	LFB7F
	POP	HL
	PUSH	IY
	POP	BC
	PUSH	IX
	POP	DE
	POP	IY
	POP	IX
	SBC	HL,DE
	EI
	RET
;
LFB97	SLA	D
	JP	C,LFB7C
	LD	A,#E9
	CP	B
	JP	P,LFBAF
	XOR	A
	CP	C
	JP	NZ,LFBC4
	LD	C,#01
	CALL	LFBEC
	JP	LFB76
LFBAF	XOR	A
	CP	C
	JP	Z,LFB76
	INC	HL
	CALL	LFBF8
	LD	A,#09
	CP	L
	JP	Z,LFBD4
	SCF
	RR	H
	JP	LFB76
;
LFBC4	INC	HL
	CALL	LFC04
	LD	A,#09
	CP	L
	JP	Z,LFBDB
	AND	A
	RR	H
	JP	LFB76
;
LFBD4	XOR	A
	OR	H
LFBD6	JP	PE,LFBE2
	JR	LFBE8
;
LFBDB	XOR	A
	OR	H
LFBDD	JP	PO,LFBE2
	JR	LFBE8
;
LFBE2	POP	HL
	LD	(HL),A
	INC	HL
	JP	LFB6F
;
LFBE8	INC	IY
	JR	LFBE2
;
LFBEC	LD	B,#01
LFBED	EQU	$-1
LFBEE	CALL	LFC10
	DJNZ	LFBEE
	LD	B,#14
LFBF4	EQU	$-1
LFBF5	DJNZ	LFBF5
	RET
;
LFBF8	LD	B,#01
LFBFA	LD	A,(LFC10)
	DJNZ	LFC06
	LD	B,#46
LFC00	EQU	$-1
LFC01	DJNZ	LFC01
	RET
;
LFC04	LD	B,#01
LFC06	LD	A,(LFC10)
	DJNZ	LFC06
	LD	B,#7D
LFC0C	EQU	$-1
LFC0D	DJNZ	LFC0D
	RET
;
LFC10	PUSH	BC
	LD	B,#A0
LFC13	DJNZ	LFC13
	POP	BC
	RET
;
LFC17	DI
LFC18	PUSH	BC
	LD	B,#04
LFC1B	EXX
	CALL	OUT_BIT1
	EXX
	DJNZ	LFC1B
	POP	BC
	DJNZ	LFC18
	LD	HL,#0000
LFC26	EQU	$-2
LFC28	CALL	OUT_BIT0
	LD	DE,#03E8
LFC2C	EQU	$-2
	XOR	A
	BIT	0,(HL)
	CALL	Z,OUT_BIT0
	CALL	NZ,OUT_BIT1
	BIT	1,(HL)
	CALL	Z,OUT_BIT0
	CALL	NZ,OUT_BIT1
	BIT	2,(HL)
	CALL	Z,OUT_BIT0
	CALL	NZ,OUT_BIT1
	BIT	3,(HL)
	CALL	Z,OUT_BIT0
	CALL	NZ,OUT_BIT1
	BIT	4,(HL)
	CALL	Z,OUT_BIT0
	CALL	NZ,OUT_BIT1
	BIT	5,(HL)
	CALL	Z,OUT_BIT0
	CALL	NZ,OUT_BIT1
	BIT	6,(HL)
	CALL	Z,OUT_BIT0
	CALL	NZ,OUT_BIT1
	BIT	7,(HL)
	CALL	Z,OUT_BIT0
	CALL	NZ,OUT_BIT1
	OR	(HL)
	EX	DE,HL
LFC71	CALL	PO,OUT_BIT0
LFC74	CALL	PE,OUT_BIT1
	INC	DE
	SBC	HL,DE
	CALL	OUT_BIT1
	EX	DE,HL
	JP	NZ,LFC28
	CALL	OUT_BIT1
	IN	A,(#EF)
	EI
	RET
;
LFC88	CALL	LFCD6
	JR	LFC8F
OUT_BIT1
	LD	B,1
LFC8E	EQU	$-1
LFC8F	IN	A,(#EF)
	CALL	LFCB2
	OUT	(#EF),A
	CALL	LFCB9
	DJNZ	LFC88
	RET
;
LFC9C	CALL	LFCD4
	JR	LFCA4
OUT_BIT0
	PUSH	AF
	LD	B,#02
LFCA3	EQU	$-1
LFCA4	IN	A,(#EF)
	CALL	LFCC2
	OUT	(#EF),A
	CALL	LFCCA
	DJNZ	LFC9C
	POP	AF
	RET
;
LFCB2	PUSH	BC
	LD	B,#6B
LFCB5	DJNZ	LFCB5
	POP	BC
	RET
;
LFCB9	PUSH	BC
	LD	B,#69
LFCBC	DJNZ	LFCBC
	LD	A,#00
	POP	BC
	RET
;
LFCC2	PUSH	BC
	LD	B,#33
LFCC5	DJNZ	LFCC5
	POP	BC
	XOR	A
	RET
;
LFCCA	PUSH	BC
	LD	B,#2C
LFCCD	DJNZ	LFCCD
	POP	BC
	LD	A,#00
	NOP
	RET
;
LFCD4	PUSH	BC
	POP	BC
LFCD6	LD	A,#00
	LD	A,#00
	RET
;
T_TRANS	DEFB	"TRANSMIT "
	DEFB	1
;
T_RECEI	DEFB	"RECEIVE "
	DEFB	1
;
T_ERROR
	DEFB	" ERROR	"
	DEFB	2
T_COMA
	DEFB	0
;
T_MAIN	DEFB	"  Copyright (Research)soft'94	 "
	DEFB	" ZX-MODEM by Morohovsky Victor	 "
	DEFB	"     CCITT - V24 standard.	 "
	DEFB	"Stop bit = 1; Start bit = 0	 "
	DEFB	"Parity:   ODD:EVEN (P to select)"
	DEFB	"Baud rate:600:1200 (B to select)"
	DEFB	"  PRESS: Q for	QUIT		 "
	DEFB	"  T for TRANSMIT, R for RECEIVE "
	DEFB	"   (Transmit X,Y ; Receive X)	 "
	DEFB	"________________________________"
	DEFB	0
;
EOF

